# 메모리

## 📌 면접 예상 질문

<details>
  <summary>Q1. 메모리를 계층 구조로 관리하는 이유를 설명해주세요.</summary>
  </br>
  
>  <p>커널은 운영체제의 핵심으로, 프로세스·메모리·파일 시스템·I/O 관리 등 시스템 운영을 담당합니다. <br/>
>    시스템 콜은 응용 프로그램이 커널 기능을 사용할 수 있도록 하는 인터페이스입니다. <br/>
>    응용 프로그램은 시스템 콜을 통해 커널에 요청을 보내고, 커널은 이를 처리하여 자원에 안전하게 접근하도록 합니다. <br/>
>    이때 modebit을 이용해 유저 모드(1)와 커널 모드(0)를 구분하여 보안과 안정성을 유지합니다.
>  </p>
</details>

<details>
  <summary>Q2. 캐시 메모리의 역할과 지역성의 원리에 대해 설명해주세요.</summary>
  </br>
  
>  <p>캐시 메모리는 CPU와 메모리 간 속도 차이를 줄이기 위해 자주 사용하는 데이터를 임시로 저장하는 고속 메모리입니다. <br/>
>    이를 통해 CPU가 필요한 데이터를 빠르게 가져올 수 있어 성능이 향상됩니다. <br/>
>    시간 지역성(Temporal Locality): 최근에 사용한 데이터는 다시 사용될 가능성이 높음. <br/>
>    공간 지역성(Spatial Locality): 현재 참조된 데이터의 근처 데이터도 곧 사용될 가능성이 높음. <br/>
>    CPU는 이러한 원리를 활용해 자주 사용되는 데이터를 캐시에 저장하여 접근 속도를 최적화합니다.
>  </p>
</details>

<details>
  <summary>Q3. 가상 메모리에서 페이지 폴트가 발생하는 원인과 해결 방법을 설명해주세요.</summary>
  </br>
  
>  <p> 페이지 폴트(Page Fault)는 프로세스가 참조한 페이지가 물리 메모리(RAM)에 없는 경우 발생합니다. <br/>
>    즉, 실행 중인 프로그램이 가상 메모리의 데이터를 필요로 하지만, 해당 데이터가 실제 RAM에 적재되지 않은 상태일 때 발생합니다.  <br/>
>     해결 방법:
>     - 스와핑(Swapping): 사용하지 않는 페이지를 디스크로 옮기고, 필요한 페이지를 RAM에 적재 <br/>
>     - 페이지 교체 알고리즘 적용: FIFO, LRU, LFU 등을 사용해 적절한 페이지를 교체 <br/>
>     - 물리 메모리 확장: RAM 용량을 늘려 페이지 폴트 발생 가능성을 줄임 <br/>
>     페이지 폴트가 과도하게 발생하면 스레싱(Thrashing)이 일어나 성능이 급격히 저하될 수 있으므로, 적절한 메모리 관리가 필요합니다.
>  </p>
</details>

## 📌 내용 정리

### 메모리 계층
> **메모리 계층**은 **레지스터, 캐시, 메모리, 주기억장치, 보조기억장치**로 구성

![메모리_계층](https://github.com/user-attachments/assets/4701768d-087a-4371-8c30-cc6ae68e560a)

- **레지스터**: CPU 내의 작은 메모리 / 휘발성, 속도 가장 빠름, 기억 용량이 가장 적음.
- **캐시**: CPU내의 L1, L2 캐시 / 휘발성, 속도 빠름, 기억 용량이 적음.
- **주기억장치**: RAM / 휘발성, 속도 보통, 기억 용량이 보통
- **보조기억장치**: HDD, SSD / 비휘발성, 속도 낮음, 기억 용량이 많습니다.


### 계층이 존재하는 이유

- **더 빠른 접근과 처리속도(캐시)**
  - 많이 접근하는 특정 데이터를 캐시 메모리에 저장 -> 빠른 접근과 처리 속도 증가
    
- **비용의 효율성**
  - 아래로 내려갈수록 저렴
    
- **자원의 효율적 사용**
  - 자주 접근하는 데이터는 빠른 메모리에, 덜 접근하는 데이터는 느린 메모리에 저장
  - ex) 로딩중: 하드디스크 또는 인터넷에서 데이터를 읽어 RAM으로 전송하는 과정이 끝나지 않았음을 의미


### 캐시
![캐시히트와_캐시미스](https://github.com/user-attachments/assets/7b2754ca-aabc-4d2e-8f85-5346f18d9b29)

- **캐시**
    > 데이터를 미리 복사해 놓는 임시 저장소 <br/>
    > 빠른 장치와 느린 장치에서 속도 차이에 따른 병목 현상을 줄이기 위한 메모리

- **캐시히트**
    > 캐시에서 원하는 데이터를 찾은 것
- **캐시미스**
    > 캐시에서 원하는 데이터를 찾지 못한 것

### 지역성의 원리
> 캐시를 설정할 때는 자주 사용하는 데이터를 기반으로 설정해야함 <br/>
> 이 때 지역성을 기반으로 설정되고 **시간 지역성**과 **공간 지역성**으로 나뉨

- **시간지역성**: 최근 사용한 데이터에 다시 접근하려는 특성
- **공간지역성**: 최근 접근한 데이터를 이루고 있는 공간이나 인접한 공간에 접근하는 특성

### 캐시매핑
> 캐시의 크기는 메모리보다 항상 작기 때문에 효율적 매핑이 중요 <br/>
> 매핑 방식에는 **직접 매핑**, **연관 매핑**, **집합-연관 매핑**이 있음

- **직접 매핑**: 메모리의 특정 블록은 특정 캐시 라인에만 매핑할 수 있는 것
  - 1번 캐시에는 1~20 메모리를 매핑, 2번 캐시에는 21~40, ...
- **연관 매핑**: 순서를 일치시키지 않고 관련 있는 캐시와 메모리를 매핑
  - 충돌이 줄지만 전체를 참조해야하기 때문에 속도가 느림
- **집합 연관 매핑**: 직접 매핑과 연관 매핑을 합쳐 놓은 것

## 메모리 관리

### 가상 메모리
> 디스크(보조 기억 장치)를 활용하여 실제 메모리보다 큰 주소 공간을 관리하는 기법 <br/>
> 가상 메모리는 가상 주소와 실제 주소가 매핑 <br/>
> 프로세스의 주소 정보가 들어있는 **페이지 테이블**로 관리 / 속도 향상을 위한 **TLB** 사용

### 스와핑
> 가상 메모리에는 존재하지만, 실제 메모리(RAM)에는 없는 경우 페이지 폴트가 발생 <br/>
> 당장 사용하지 않는 영역을 디스크로 옮기고 실제 메모리 공간 사용

### 스레싱
> 페이지 폴트율이 높을 때, 스와핑이 많이 일어나고, CPU 이용률이 낮아짐 <br/>
> CPU 이용률이 낮아지면 운영체제는 CPU 가용성을 높이기 위해 더 많은 프로세스를 메모리에 올리고, 다시 스와핑이 일어나는 악순환 발생 <br/>
> 해결 방법: 메모리 공간 늘리기 or HDD를 SDD로 교체

### 메모리 할당
> 메모리에 프로그램을 할당할 때 시작 메모리 위치, 메모리의 할당 크기를 기반으로 할당

- **연속 할당**: 메모리에 연속적으로 공간을 할당
  - 고정 분할 방식
  - 가변 분할 방식

- **불연속 할당**: 메모리에 연속적으로 할당하지 않는 방법
  - 페이징 기법
  - 세그멘테이션
  - 페이지드 세그멘테이션

### 페이지 교체 알고리즘

- **오프라인 알고리즘(LFD)**:  1. 더 이상 참조되지 않거나 2. 가장 늦게 다시 참조되는 페이지와 지금 요청된 페이지를 바꾸는 알고리즘
- **FIFO**:  가장 먼저 온 페이지부터 교체
- **LRU**:  최근에 사용되지 않는 페이지를 바꾸는 방법
- **NUR**:  clock 알고리즘, 시계 방향으로 돌면서 0을 찾는 순간 페이지를 교체
- **LFU**:  가장 참조 횟수가 적은 페이지를 교체하는 알고리




