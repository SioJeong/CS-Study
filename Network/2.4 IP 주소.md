# IP 주소

## 📌 면접 예상 질문

<details>
  <summary>Q1. ARP란 무엇이며, 어떻게 동작하나요?</summary>
  </br>
  <p>IP 주소로부터 MAC 주소를 찾는 프로토콜입니다. 네트워크에서 장치 간 통신은 최종적으로 MAC 주소 기반으로 이루어지므로, IP 주소만으로는 직접 통신할 수 없습니다.</p>
  <p>따라서, ARP는 특정 IP 주소를 가진 장치의 MAC 주소를 찾기 위해 브로드캐스트 ARP Request를 전송하고, 해당 장치는 유니캐스트 ARP Reply를 통해 MAC 주소를 응답합니다.
이렇게 얻은 MAC 주소는 ARP 캐시 테이블에 저장되어 반복적인 요청을 방지합니다.</p>
</details>

<details>
  <summary>Q2. IPv4와 IPv6의 차이점은 무엇인가요?</summary>
  </br>
  <p>IPv4는 32비트 주소 체계를 사용해 약 43억 개의 IP 주소를 제공하지만, 사용자가 증가하면서 주소 부족 문제가 발생했습니다. 
    이를 해결하기 위해 IPv6가 도입되었으며, 128비트 주소 체계를 사용해 사실상 무제한의 주소를 제공합니다.</p>
  <p>IPv4에서는 공인 IP 부족 문제로 인해 NAT(Network Address Translation)이 필수적이지만, IPv6는 모든 기기가 고유한 공인 IP를 가질 수 있어 NAT이 필요 없습니다. 
    또한, IPv6는 IPSec을 기본 내장하여 보안성이 강화되었으며, 자동 IP 할당(SLAAC) 기능을 지원해 네트워크 운영이 더욱 효율적입니다.</p>
</details>

<details>
  <summary>Q3. NAT의 역할과 유형에 대해 설명해주세요.</summary>
  </br>
  <p>NAT는 IP 주소를 변환하여 내부 네트워크와 외부 네트워크 간 통신을 가능하게 하는 기술입니다. IPv4 주소가 부족한 상황에서 사설 IP와 공인 IP 간의 매핑을 수행하여 하나의 공인 IP를 여러 기기가 공유할 수 있도록 합니다.</p>
  <p>NAT에는 세 가지 주요 유형이 있습니다. <br>
첫 번째로, 정적 NAT는 내부 네트워크의 특정 사설 IP 주소를 하나의 공인 IP 주소에 고정적으로 매핑하는 방식입니다.<br>
두 번째로, 동적 NAT는 여러 개의 내부 IP 주소를 제한된 공인 IP 풀에서 동적으로 할당하는 방식입니다.<br>
마지막으로, PAT는 하나의 공인 IP 주소를 여러 개의 내부 IP 주소가 공유하는 방식으로, 각 패킷의 출발지 포트 번호를 변경하여 장치를 구분합니다.</p>
</details>

<br>
<br>

## 📌 내용 정리
### ARP
> 컴퓨터와 컴퓨터 간의 통신은 IP 주소에서 ARP를 통해 MAC 주소를 찾아 MAC 기반으로 통신
- ARP(Address Resolution Protocol)란 **IP 주소로부터 MAC 주소를 구하는 다리 역할**을 하는 프로토콜이다.
- 논리적 주소 -> **ARP** -> 물리적 주소
- 물리적 주소 -> **RARP** -> 논리적 주소

<br>

#### ARP 캐시 테이블
- ARP **요청이 반복되지 않도록**, 응답받은 MAC 주소를 일정 시간 동안 저장하는 테이블이다.
- `arp -a` 명령어를 통해 확인할 수 있다.

<br>

#### 동작 방식
- 장치 A가 **ARP Request 브로드캐스트**를 보내서 IP 주소에 해당하는 MAC 주소를 찾는다.
- 각각의 장치가 **ARP Reply 유니캐스트**를 통해서 MAC 주소를 반환한다.

<br>

#### 브로드캐스트와 유니캐스트 비교
| 구분 | 브로드캐스트 | 유니캐스트 |
|------|------|------|
| 전송 방식 | 네트워크에 있는 모든 장치로 패킷 전송 | 특정 목적지(MAC 주소)를 가진 장치로만 패킷 전송 |
| 트래픽 영향 | 네트워크 부하 증가 가능 | 네트워크 효율적 사용 |
| 사용 예시	 | ARP 요청 | ARP 응답, 일반적인 IP 패킷 전송 |

<br>

#### ARP 스푸핑
> 공격자가 **위조된 ARP 응답을 보내 통신을 가로채거나 조작**하는 공격 방식
- 공격자는 **자신의 MAC 주소를 특정 IP 주소에 대한 응답으로 속여** 피해자의 패킷을 중간에서 가로채고 변조하거나 감청할 수 있다.
- **방어 방법**
  - **정적 ARP 테이블 설정**: 중요한 서버에 대해서는 수동으로 IP-MAC 매핑을 설정
  - **패킷 분석 도구 사용**: Wireshark, ARPwatch 등을 사용하여 ARP 테이블 변화를 감지
  - **DHCP 스누핑 및 다이내믹 ARP 검사(Dynamic ARP Inspection, DAI)**: 네트워크 스위치에서 비정상적인 ARP 패킷을 차단

<br>
<br>

---

<br>
<br>

### 홉바이홉 통신
> IP 주소를 통해 통신하는 과정
- 홉(hop) : 통신망에서 각 패킷이 여러 개의 라우터를 건너가는 모습을 표현
- 통신 장치에 있는 **라우팅 테이블**의 IP를 통해 시작 주소부터 다음 IP로 이동하는 **라우팅** 과정을 거쳐 패킷이 최종 목적지에 도달하는 통신을 뜻한다.

<br>

#### TTL(Time To Live)
- 패킷이 지나친 라우터 수(홉)가 일정 수치를 넘으면 자동 폐기됨 (루프 방지)

<br>

#### 라우팅 테이블
- 송신지에서 수신지까지 도달하기 위해 사용된다.
- 라우터에 들어가 있는 목적지 정보들과 그 목적지로 가기 위한 방법을 저장한다.

<br>

#### 게이트웨이
- **서로 다른 통신망, 프로토콜을 사용하는 네트워크 간의 통신을 가능**하게 하는 관문 역할을 하는 컴퓨터나 소프트웨어를 의미한다.
- `netstat -r` 명령어를 통해 확인할 수 있다.

<br>

#### MTU (Maximum Transmission Unit)
> 네트워크에서 한 번에 전송할 수 있는 최대 패킷 크기를 의미
- MTU보다 큰 데이터는 **패킷 분할**(Fragmentation)이 일어나며, 이는 라우팅 성능 저하 및 패킷 손실 가능성 증가를 초래할 수 있다.

<br>

#### ICMP Redirect 메시지
- 라우터가 더 나은 경로를 알게 되었을 때 이를 클라이언트에게 알려주는 기능이다.
- 보안상 위험이 될 수 있어 일반적으로 차단하는 경우가 많다.

<br>
<br>

---

<br>
<br>

### IP 주소 체계
- IPv4 : **32비트를 8비트** 단위로 표기
- IPv6 : **128비트를 16비트** 단위로 표기 (일반적으로 64비트씩 나누어 네트워크와 호스트를 구분)

<br>

#### IPv4 vs IPv6 비교
| 구분 | IPv4 | IPv6 |
|------|------|------|
| 주소 길이 | 32비트 | 128비트 |
| 주소 개수 | 약 43억 개 | 사실상 무제한 |
| 표기 방식 | 10진수(192.168.0.1) | 16진수(2001:db8::ff00:42:8329) |
| 보안성 | 낮음 (IPSec 선택 사항) | 높음 (IPSec 기본 내장) |
| NAT 필요성 | 필요 (IPv4 주소 부족) | 불필요 (고유 주소 제공 가능) |

<br>

#### 클래스 기반 할당 방식 
![image](https://github.com/user-attachments/assets/e04dd511-60ff-49d2-969b-0761d6af2bec)
- A, B, C, D, E 다섯 개의 클래스로 구분하는 클래스 기반 할당 방식(CIDR) 사용
- **A, B, C는 일대일 통신**으로 사용되고, **D는 멀티캐스트** 통신, **E는 예비용**이다.
- 맨 왼쪽에 있는 비트를 **구분 비트**라고 한다.
 
<br>

#### DHCP
> DHCP(Dynamic Host Configuration Protocol)는 IP 주소 및 기타 통신 매개변수를 자동으로 할당하기 위한 네트워크 관리 프로토콜
- 네트워크 장치의 IP 주소를 수동으로 설정할 필요없이 **인터넷에 접속할 때마다 자동으로 IP 주소를 할당**한다.

<br>

#### DHCP 동작 방식
> DORA 과정을 통해 IP 주소를 할당한다.
1. Discovery: 클라이언트가 DHCP 서버를 찾기 위해 브로드캐스트 패킷 전송
2. Offer: DHCP 서버가 사용 가능한 IP 주소를 제안
3. Request: 클라이언트가 특정 IP 주소를 요청
4. Acknowledge: DHCP 서버가 IP 주소 할당을 확인

<br>


#### NAT
> NAT(Network Address Translation)는 패킷이 라우팅 장치를 통해 전송되는 동안 패킷의 IP 주소 정보를 수정하여 IP 주소를 다른 주소로 매핑하는 방법
- IPv4 주소 체계만으로는 많은 주소를 감당하지 못해, NAT로 공인 IP와 사설 IP로 나누어서 처리한다.
- NAT를 가능하게 하는 소프트웨어는 ICS, RRAS, Netfilter 등이 있다.
- **내부 네트워크에서 사용하는 IP 주소**와 **외부에 드러나는 IP 주소**를 **다르게** 유지할 수 있기 때문에 **어느 정도의 보안이 가능**하다.
- 여러 명이 동시에 접속하게 되므로 접속하는 호스트의 숫자에 따라 느려질 수 있다. 

<br>

#### NAT 유형
- **정적 NAT**: 내부 IP 하나를 특정 공인 IP에 매핑
- **동적 NAT**: 여러 내부 IP를 제한된 공인 IP 풀에서 동적으로 할당
- **PAT (포트 기반 NAT)**: 다수의 내부 IP가 **하나의 공인 IP를 공유하며 포트번호를 변경하여 구분**
