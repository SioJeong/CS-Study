# TCP/IP 4계층 모델

## 📌 면접 예상 질문

<details>
  <summary>Q1. TCP와 UDP의 차이점은 무엇인가요?</summary>
  <br />
 <p>TCP와 UDP는 전송 계층에서 전송 계층에서 사용하는 데이터를 보내기 위해 사용하는 프로토콜로, 주요 차이점은 신뢰성과 속도에 있습니다.</p> 
  
  <p>TCP는 연결 지향형 프로토콜로, 오류 없는 데이터 전송을 보장하고 3-웨이 핸드셰이크 과정을 통해 신뢰성 높은 데이터 전송을 지원하지만 신뢰성 처리 시간으로 인해 UDP 보다 상대적으로 느립니다. 이와 같은 특징으로 웹 브라우징, 이메일 전송, 파일 다운로드와 같은 애플리케이션에 주로 사용됩니다.</p> 
  
  <p>UDP는 비연결형 프로토콜로, 데이터 순서를 보장하지 않습니다. 그만큼 신뢰성은 낮지만 상대적으로 속도가 빠르다는 장점이 있어 실시간 애플리케이션에서 주로 사용됩니다.</p> 
</details>

<details>
  <summary>Q2. TCP/IP 4계층에 대해서 설명해주세요.</summary>
  <br />
  <p>TCP/IP 4계층은 네트워크 통신을 관리하는 모델로</p>

물리적으로 데이터를 전달하는 링크 계층,
다른 네트워크로 데이터를 전달하도록 라우팅을 수행하는 네트워크 계층,
신뢰성 있는 데이터 전송을 담당하는 전송 계층,
애플리케이션과 서비스를 제공하는 애플리케이션 계층으로 구성됩니다.
 
</details>

<details>
  <summary>Q3. 3-way 핸드셰이크, 4-way 핸드셰이크에 대해 설명해 주세요.</summary>
  <br />
  <p>3-way 핸드셰이크와 4-way 핸드셰이크는 TCP를 사용한 네트워크 통신에서 네트워크 연결을 설정하고 해제하는 과정을 관리하는 프로토콜입니다.</p>
    <p>TCP 연결 설정은 3-way handshake 방식으로 이루어지며, 클라이언트가 서버에 SYN 패킷을 보내 연결을 요청하고, 서버는 SYN+ACK로 응답한 뒤, 클라이언트가 ACK를 보내면서 연결이 완료됩니다.</p>
   <p>연결 종료는 4-way handshake 방식으로, 한쪽에서 FIN 패킷을 보내 종료를 요청하면 상대방이 ACK로 응답하고, 이후 상대방도 FIN을 보내면 최종적으로 ACK를 보내며 연결이 종료됩니다.</p>
   <p>이를 통해 TCP는 신뢰성 있는 데이터 전송을 보장하며, 안전하게 연결을 설정하고 해제할 수 있습니다.</p>

</details>

---

## 📌 내용 정리
💡 ```인터넷 프로토콜 스위트``` 란?

- 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 프로토콜의 집합
- TCP/IP 4계층 혹은 OSI 7계층 모델로 설명
    
### 1. 계층 구조
![](https://velog.velcdn.com/images/chtoqur/post/b396b234-4eda-46fb-886f-db789e51d86c/image.png)
> 각각의 계층들은 특정 계층이 변경되었을 때 다른 계층이 영향 받지 않도록 설계됨

👉 TCP/IP의 각 계층을 대표하는 스택
![](https://velog.velcdn.com/images/chtoqur/post/203d4f3d-697e-4ea8-892b-9b07f69247f6/image.png)

### 1.1 애플리케이션 계층, application layer

💡 ```애플리케이션 계층``` 이란?

- FTP, HTTP, SSH, SMTP, DNS 등 응용 프로그램이 사용되는 프로토콜 계층
- 웹 서비스, 이메일 등의 서비스를 실질적으로 사람들에게 제공하는 층

👉 프로토콜 용어

🔗 ```FTP```

장치와 장치 간의 파일을 전송하는 데 사용되는 표준 통신 프로토콜
    
🔗 ```SSH```
	
보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜
    
🔗 ```HTTP```
	
World Wide Web을 위한 데이터 통신의 기초이자 웹 사이트를 이용하는 데 쓰는 프로토콜
    
🔗 ```SMTP```
	
전자 메일 전송을 위한 인터넷 표준 통신 프로토콜
    
🔗 ```DNS```
	
도메인 이름과 IP 주소를 매핑해주는 서버

### 2.2 전송 계층, transport layer

💡 ```전송 계층``` 이란?

- 송신자와 수신자를 연결하는 통신 서비스를 제공
- 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어를 제공
- 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때의 중계 역할을 수행
- ex. TCP, UDP

🔗 ```TCP```

1) 패킷 사이의 순서를 보장
2) 연결지향 프로토콜을 사용
👉 신뢰성 구축, 수신 여부 확인, '가상회선 패킷 교환 방식' 사용
    
> ```가상회선 패킷 교환 방식``` : 각 패킷에 가상회선 식별자가 포함되며, 모든 패킷을 전송할 시 가상 회선은 해제되고 패킷들은 전송된 **순서대로** 도착하는 방식

> ```데이터그램 패킷 교환 방식``` : 패킷이 독립적으로 이동 & 최적의 경로를 선택하며 가는 방식으로, 도착한 **순서가 다를 수 있는** 방식

⭐️ TCP는 연결 성립 + 신뢰성을 확보할 때 ```3-웨이 핸드셰이크(3-way handshake)``` 작업을 진행함
![](https://velog.velcdn.com/images/chtoqur/post/5f866709-2d83-42d0-ae2e-fbe0676b24dc/image.png)

1. SYN 단계 : 클라이언트가 서버에 클라이언트의 ISN을 담아 SYN을 전송 (cf. ISN : 새로운 TCP 연결의 첫 번째 패킷에 할당된 임이의 시퀀스 번호)
2. SYN + ACK 단계 : 서버는 클라이언트의 SYN을 수신 > 서버의 ISN을 전송 + 승인 번호로 클라이언트의 ISN + 1을 보냄
3. ACK 단계 : 클라이언트는 서버의 ISN + 1한 값인 승인번호를 담아 ACK를 서버에 보냄

> 3-way 핸드셰이크 과정 이후 신뢰성이 구축되고 데이터 전송을 시작함. TCP는 해당 과정이 있기 때문에 신뢰성이 있는 계층, UDP는 이 과정이 없기 때문에 신뢰성이 없는 계층이라고 칭함

🔗 ```SYN```
	
 SYNchronization의 약자, 연결 요청 플래그

🔗 ```ACK```
	
  ACKnowledgement의 약자, 응답 플래그

🔗 ```ISN```
	
 Initial Sequence Numbers의 약어, 초기 네트워크 연결 시 할당된 32비트 고유 시퀀스 번호
 
⭐️ TCP가 연결을 해제할 때는 ```4-웨이 핸드셰이크(4-way handshake)``` 과정을 진행함

![](https://velog.velcdn.com/images/chtoqur/post/b14859c6-18cc-41ef-a680-f7cfedbe9f68/image.png)

1. 클라이언트가 연결을 닫으려고 할 때 FIN 으로 설정된 세그먼트를 전송 > FIN_WAIT_1 상태에서 서버의 응답 기다림
2. 서버는 클라이언트로 ACK 승인 세그먼트를 보내고 CLOSE_WAIT 대기 상태에 들어감 > 클라이언트가 세그먼트를 받으면 FIN_WAIT_2 상태에 들어감
3. 서버는 일정 시간 이후 클라이언트에에 FIN 세그먼트를 전송
4. 클라이언트는 TIME_WAIT 상태가 되고 다시 서버로 ACK을 전송 > 서버는 CLOSED 상태 > 어느 정도의 시간을 대기하고 연결이 닫히고 클라이언트와 서버의 모든 자원 연결이 해제됨

❓ 일정 시간 뒤에 연결을 닫는 이유 (TIME_WAIT)
- 지연 패킷이 발생할 경우 대비 (데이터 무결성 대비)
- 두 장치의 연결이 닫혔는지 확인하기 위함 (장치가 LAST_ACK 상태를 유지하는 것 방지)

🔗 ```TIME_WAIT```
	
소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태를 말하며 지연 패킷 등의 문제점을 해결하는 데 사용됨

### 2.3 인터넷 계층, internet layer

💡 ```인터넷 계층``` 이란?

- 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층
- 패킷을 수신해야 할 상대의 주소를 지정하여 데이터를 전달
- 상대방이 제대로 받았는지 보장하지 않는 **비연결형적** 성격
- ex. IP, ARP, ICMP

### 2.4 링크 계층, link layer

💡 ```링크 계층``` 이란?

-  전선, 광섬유, 무선 등으로 실질적으로 데이터를 전달하
며 장치 간에 신호를 주고받는 ‘규칙’을 정하는 계층
- 네트워크 접근 계층이라고도 부름
- 물리 계층과 데이터 링크 계층으로 나누기도 함
	1) 물리 계층: 무선 LAN과 유선 LAN을 통해 0과 1로 이루어진 데이터를 보내는 계층
    2) 데이터 링크 계층: ‘이더넷 프레임’을 통해 에러 확인, 흐름 제어, 접근 제어를 담당하는 계층
    
#### 유선 LAN

> 유선 LAN을 이루는 이더넷은 IEEE802.3이라는 프로토콜을 따르며 전이중화 통신을 사용

### 2.4.1 전이중화 통신 (Full Duplex Communication)

💡 `전이중화 통신` 이란?

- 양쪽 장치가 동시에 송수신할 수 있는 방식
- 송신로와 수신로가 분리되어 있어 충돌이 발생하지 않음
- 현대의 고속 이더넷은 이 방식을 기반으로 통신

### 2.4.2 반이중화 통신과 CSMA/CD

💡 `반이중화 통신 (Half Duplex Communication)` 이란?

- 양쪽 장치가 서로 통신할 수는 있지만, 동시에 통신할 수 없음
- 한 번에 한 방향만 통신 가능
- 충돌 가능성이 존재하여 충돌 감지 및 방지 시스템 필요

🔗 `CSMA/CD (Carrier Sense Multiple Access with Collision Detection)`

- 반이중화 통신을 사용하는 유선 LAN에서 데이터를 보낸 후 충돌이 발생하면 일정 시간 후 재전송하는 방식
- 송신로와 수신로가 분리되지 않은 환경에서 충돌을 방지하기 위해 사용됨

### 2.4.3 유선 LAN을 이루는 케이블

💡 `트위스트 페어 케이블 (Twisted Pair Cable)`

- 하나의 케이블처럼 보이지만 실제로는 여덟 개의 구리선을 두 개씩 꼬아 놓은 구조
- UTP(Unshielded Twisted Pair): 실드 처리가 없는 일반적인 LAN 케이블
- STP(Shielded Twisted Pair): 실드 처리가 되어 있어 외부 간섭에 강함
- RJ-45 커넥터: 트위스트 페어 케이블을 연결하는 커넥터

💡 `광섬유 케이블 (Optical Fiber Cable)`
![](https://velog.velcdn.com/images/chtoqur/post/5b7403eb-5d77-45c8-9ed5-154a1c718508/image.png)

- 레이저를 이용하여 장거리 및 고속 통신이 가능
- 빛의 반사 원리를 이용하여 신호를 전송
- 코어(Core): 빛의 굴절률이 높은 중심 부분
- 클래딩(Cladding): 빛의 굴절률이 낮은 외부 층

### 2.4.4 무선 LAN (IEEE 802.11)

💡 `무선 LAN` 이란?

- 유선 LAN과 달리 공기를 통해 데이터를 주고받는 방식
- 2.4GHz 또는 5GHz 대역을 사용
- 2.4GHz: 장애물에 강하지만 간섭이 많음
- 5GHz: 간섭이 적고 깨끗한 신호 제공

🔗 `CSMA/CA (Carrier Sense Multiple Access with Collision Avoidance)`

- 무선 LAN에서 충돌을 방지하는 방식
- 데이터를 보내기 전에 무선 매체의 상태를 감지하여 충돌 가능성을 최소화
- 과정:
  1. 송신 전 무선 매체를 살펴 충돌 가능성 확인
  2. 캐리어 감지 후 IFS(Inter Frame Space) 값을 기반으로 대기
  3. 충돌 가능성이 없으면 데이터 송신

### 2.4.5 와이파이 (Wi-Fi)

💡 `Wi-Fi` 란?

- 무선 LAN 신호를 이용하여 기기들이 네트워크에 연결할 수 있도록 하는 기술
- AP(Access Point, 공유기)를 통해 유선 신호를 무선 신호로 변환
- 와이파이 외에도 지그비(Zigbee), 블루투스(Bluetooth) 등의 무선 통신 기술이 존재

🔗 `BSS (Basic Service Set)`

- 단일 AP 기반으로 무선 네트워크를 구축하는 구조
- AP가 커버하는 범위 내에서만 통신 가능

🔗 `ESS (Extended Service Set)`

- 여러 개의 BSS가 연결된 네트워크 구조
- 사용자가 이동하면서도 네트워크 연결이 유지됨

### 2.4.6 이더넷 프레임 구조

💡 `이더넷 프레임 (Ethernet Frame)`

- 데이터 링크 계층에서 데이터 전송 시 사용하는 기본 단위

| 필드 | 설명 |
|------|------|
| Preamble | 프레임의 시작을 알림 |
| SFD (Start Frame Delimiter) | MAC 주소 필드 시작을 알림 |
| DMAC (Destination MAC) | 수신 MAC 주소 |
| SMAC (Source MAC) | 송신 MAC 주소 |
| EtherType | 상위 계층 프로토콜 지정 (예: IPv4, IPv6) |
| Payload | 전송할 데이터 |
| FCS (Frame Check Sequence) | 오류 검출을 위한 체크섬 |
